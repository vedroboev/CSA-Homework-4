# Домашнее задание по АВС № 4

*Выполнил Абаев Федор, БПИ 203*

**Вариант 81:** *11 артефакт, 6 функция*

## Описание программы

Программа представляет из собой структуру модулей на языках `C/NASM`, обрабатывающую различные типы чисел - **
комплексные числа**, **дроби** и **полярные координаты**. Решение является бестиповым, все данные хранятся в
формате `<код числа><информация>`
в массиве-контейнере, работа с которым происходит с помощью указателей. На ассемблере реализована часть модуля
сортировки, а так же модуль обработки чисел (вывод их вещественного представления). В результате программа выводит в
файл контейнер в удобном для прочтения виде, а так же этот же контейнер, отсортированный с помощью **heapSort**.

---

## Важные замечания

+ В данной программе написал модуль выполнения тестов `run_all_tests.py`, его удобно использовать для проверки работы на
  всех имеющихся тестов.
+ К сожалению, не успел полностью дописать модуль сортировки на ассемблере, хотя написана большая часть. На ассемблере я
  выполняю функцию `swap(void* first, void* second)` для двух элементов контейнера, так же в файле `heapsort.asm` есть
  начало функции генерации кучи - она работает корректно, но при рекурсии вызывает `SEGFAULT`, нет сил переписывать,
  чтобы такой проблемы не было. У этой функции
  сигнатура `heapSortAsm(void* container, int index_in_bytes, int length_in_bytes)`, при желании ее можно
  протестировать. Модуль перевода чисел в вещественные эквиваленты написал **полностью**.
+ Компилировал с помощью `CMake`, в моем случае сработало, однако допускаю, что могут возникнуть проблемы на другой
  системе, надеюсь, что этого не произойдет.
+ Программа разрабатывалась с использованием системы контроля версий GIT, вся история версий должна быть доступна и при
  желании может быть просмотрена. На этот раз, правда, у меня немного поломался репозиторий при выполнении rebase, так
  что ранние коммиты присутствуют здесь не полностью.
+ ВАЖНО: отчет об ошибках при чтении чисел выводится в консоль, не в файл (так как в техническом задании требуется
  выводить в файл содержимое контейнера, в котором некорректные числа не сохраняются). В `in_main.txt` учтены основные
  некорректные способы ввода чисел, для просмотра того, какие конкретно числа не будут учтены, рекомендуется запустить
  тест заново.
+ Тесты больших объемов сгенерированы кодом на python, приведенном в папке `Tests/In`. Файл `in_main.txt` содержит
  тесты, написанные мной, которые закрывают некоторые пробелы покрытия автоматически генерируемых тестов.
+ Для удобства чтения результаты до обработки и после обработки контейнера можно выводить в разные файлы (как это
  сделать - написано ниже).

---

## Отчет

**Характеристики и сравнительный анализ:**

+ В программе есть 2 файла на языке `NASM`, 4 заголовочных файла, 6 файлов с исходным кодом на `C`. Все вместе занимает
  27 КБ, скомпилированная программа занимает 40 КБ. Исходного кода стало больше, вес скомпилированной программы стал
  меньше относительно первого дз, предполагаю, что дело в использовании `C` вместо `С++` и не использовании внешних
  библиотек, таких как CMATH.
+ Тесты содержат от 0 до 10050 элементов. Формат вывода остался практически таким же, также, как и формат ввода, поэтому
  размеры тестов и файлов с результатами не поменялись. Наиболее большие выходные файлы не превосходят 1 МБ (в
  контейнере лимит на 10000 элементов, так что планка довольно строгая), входные файлы не превышают 200 КБ.
+ Время работы не могу полноценно сравнить, так как пропустил предыдущие два дз. Сравнивая с первым ДЗ, заметил
  небольшие улучшения на максимальном допустимом размере контейнера (~0.090 против ~0.078, вся программа - то есть
  сортировка, чтение и запись).

---

## Документация тестов и кода

### Формат ввода с командной строки

##### Ввод из файла

`main.exe -f <input file> <output file> [output file 2]`

Тут `output file 2` - файл для вывода отсортированного контейнера. Если он не указан, то эта информация будет выведена в
первый файл.

Формат ввода - для каждого числа вводится его ключ из списка:

+ 1 - комплексное число
+ 2 - дробное число
+ 3 - полярные координаты

Далее вводятся параметры для данного числа через пробел:

+ Комплексное число: *вещественная_часть комплексная_часть*
+ Дробное число: *числитель знаменатель*
+ Полярные координаты: *угол радиус*

Для 1 и 3 случая вводятся вещественные числа. Для дробного числа вводятся целые числа. При вводе вещественных чисел в
качестве параметров для дробного числа оно не читается и выводится сообщение об ошибке в консоль, при этом программа
продолжает работать.

Примерно файл ввода должен выглядеть так:

```text
1 1.0 1.0
2 3 4
2 3.0 4.0
3 -1 -1
3 1231 1212
```

Каждое число читается с новой строки, все параметры, кроме первых трех, игнорируются.

Любые некорректные числа (дроби со знаменателем 0 и числа с неопределенными ключами), прочитанные из файла, не будут
помещены в контейнер, об их прочтении будет выведено на консоль.

##### Ввод случайных данных

`main.exe -r <size> <output file> [output file 2]`

Тут `output file 2` - файл для вывода отсортированного контейнера. Если он не указан, то эта информация будет выведена в
первый файл.
`size` описывает количество случайных чисел, которые следует сгенерировать и поместить в контейнер. Количество чисел
должно бьть в пределах от 1 до 10000, в противном случае выведется ошибка и приложение завершит работу.

### О тестировании

Тесты в файле `in_main.txt` написаны мной, содержат некоторые тесты на крайние значения, а так же на поведение при
некорректных данных. Файл `test_annotated.txt`
в той же папке содержит описание некоторых из этих тестов для более удобного понимания. Файлы взял из прошлых заданий,
чтобы получить корректные результаты сравнительного анализа. На отдельные файлы свой тестовый файлик разделять не стал,
но это можно было бы сделать, в `test_annotated.txt` комментарии разделяют его на секции, которые было бы логично
разделить на отдельные файлы.

**!** В этом задании добавит автотестер `run_all_tests.py`. Он автоматически выполняет все тесты из папки `In` с
префиксом
`in_`, а так же тестирует модуль случайной генерации внутри программы. Результаты выводятся в папку `Out`, файлы с
сортированным и не сортированным списком - разделены.

Генератор тестов так же включил в проект, он немного переписан, но в целом работает так же, как в моем первом задании.

### О сортировке

Для каждого числа считается его вещественный эквивалент, в выходном файле он выводится на новой строчке через табуляцию.
Сортировка происходит по возрастанию на основе этого эквивалента. При желании отсортированный контейнер можно вывести в
отдельный файл, смотреть выше.